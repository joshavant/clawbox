---
- name: Ensure OpenClaw developer source mount exists
  stat:
    path: "{{ openclaw_source_mount }}"
  register: openclaw_source_mount_stat

- name: Ensure OpenClaw developer payload mount exists
  stat:
    path: "{{ openclaw_payload_mount }}"
  register: openclaw_payload_mount_stat

- name: Fail when OpenClaw developer source mount is missing
  fail:
    msg: >-
      Expected OpenClaw source mount at {{ openclaw_source_mount }}.
      Launch the VM with --developer --openclaw-source <path>.
  when: not openclaw_source_mount_stat.stat.exists

- name: Fail when OpenClaw developer payload mount is missing
  fail:
    msg: >-
      Expected OpenClaw payload mount at {{ openclaw_payload_mount }}.
      Launch the VM with --developer --openclaw-payload <path>.
  when: not openclaw_payload_mount_stat.stat.exists

- name: Ensure ~/Developer directory exists
  become_user: "{{ vm_name }}"
  file:
    path: "/Users/{{ vm_name }}/Developer"
    state: directory

- name: Symlink ~/Developer/openclaw to OpenClaw source mount
  become_user: "{{ vm_name }}"
  file:
    src: "{{ openclaw_source_mount }}"
    dest: "{{ openclaw_dev_source_dir }}"
    state: link

- name: Symlink ~/.openclaw to OpenClaw payload mount
  become_user: "{{ vm_name }}"
  file:
    src: "{{ openclaw_payload_mount }}"
    dest: "{{ openclaw_dev_payload_dir }}"
    state: link
